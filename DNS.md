# DNS

## DNS의 필요성

인터넷 사용자는 호스트를 지칭할 때 문자형의 **도메인 이름(domain name)**을 사용한다. 초기에는 도메인 이름과 IP 주소를 매핑하여 기록한 텍스트 문서인 호스트 파일을 보급하였으나, 관리자가 변경사항을 수작업으로 반영해야했다. 이를 해결하기 위해 **DNS**가 탄생하였다.



## DNS란

**DNS(Domain Name System)**는 도메인 이름을 IP 주소로 변환하는 분산 데이터베이스 시스템이다. DNS는 도메인 네임 스페이스, 네임 서버, 해석기로 구성된다.

### 도메인 네임 스페이스

도메인 네임 스페이스(Domain Name Space)는 DNS가 관리하는 계층적 데이터베이스이다. 도메인 네임 스페이스에 등록된 호스트는 각각 최대 63바이트의 **레이블(label)**을 이름으로 가진다. 레이블이 부여된 각 호스트는 도메인 이름을 가지며, 도메인 이름은 자신의 레이블부터 루트까지 이동하면서 레이블을 `.`로 연결한 것과 같다. 

1. 루트: 널 레이블(크기가 0). 이름이 없다.
2. TLD(Top Level Domain)
   1. 일반 도메인(gTLDs; Generic Top Level Domains)
   2. 국가 도메인(ccTLDs; Country code Top Level Domain)
3. Sub-Domain: Second Level Domain, Third Level Domain...

### 네임 서버

네임 서버(Name Server)는 도메인 네임 스페이스에서 도메인 이름을 관리한다.

1. 루트 DNS 서버: 루트 도메인을 담당. ICANN이 관리
2. TLD DNS 서버: TLD를 담당. 도메인 등록 기관(Registry)가 관리
3. Authoritative DNS 서버: 서브 도메인을 담당. 도매인 판매업체(Registar)가 관리. 실제 도메인과 IP 주소의 매핑을 관리한다. 일반적으로 네임 서버를 의미한다.
4. 로컬 DNS 서버: ISP가 관리. 인터넷 사용자가 접근하는 DNS 서버이다. TTL 동안 질의한 데이터를 캐시로 저장한다.

### 해석기

해석기(Resolver)는 네임 서버에 접속하여 클라이언트가 요청한 정보를 응답한다.

### DNS 프로토콜

DNS 서비스는 클라이언트/서버 모델을 따른다. 클라이언트와 서버는 DNS 메시지의 형태로 질의하고 응답한다. DNS 메시지는 UDP를 사용하여 전달하며 크기가 512바이트를 넘으면 TCP를 사용하기도 한다. 기본 포트는 53번이다.

### DNS 동작 과정

사용자가 브라우저 주소창에 URL을 입력하면 다음과 같은 과정을 거쳐 IP 주소로 주소 변환된다.

1. 브라우저 캐시 -> 로컬 호스트 파일 -> DNS 캐시 테이블 순으로 도메인 이름을 조회한다.
2. 도메인 이름을 찾을 수 없다면 브라우저는 Resolver를 호출하여 주소 변환을 요청한다.
   1. Resolver는 DNS 프로토콜을 사용하여 로컬 DNS 서버에 주소 변환을 요청한다.
   2. 로컬 DNS 서버는 캐시에서 도메인 이름을 조회하고 없으면 DNS 루트 네임 서버에 질의한다.
   3. 루트 DNS 서버는 도메인 정보가 없다면 TLD 네임 서버의 IP 주소를 응답한다.
   4. 로컬 DNS 서버는 TLD 네임 서버에 질의한다.
   5. TLD 네임 서버는 도메인 정보가 없다면 서브 도메인 네임 서버의 IP 주소를 응답한다.
   6. 서브 도메인 네임 서버는 도메인 정보에서 IP 주소를 응답한다.
   7. 로컬 DNS 서버는 IP 주소를 캐싱하고 DNS 프로토콜을 사용하여 Resolver에게 IP 주소를 응답한다.
3. Resolver는 브라우저에게 IP 주소를 전달한다.



## 참고

- 쉽게 배우는 데이터 통신과 컴퓨터 네트워크 - 14장 DNS
- [DNS란 뭐고, 네임서버란 뭔지 개념정리](https://gentlysallim.com/dns%EB%9E%80-%EB%AD%90%EA%B3%A0-%EB%84%A4%EC%9E%84%EC%84%9C%EB%B2%84%EB%9E%80-%EB%AD%94%EC%A7%80-%EA%B0%9C%EB%85%90%EC%A0%95%EB%A6%AC/)

